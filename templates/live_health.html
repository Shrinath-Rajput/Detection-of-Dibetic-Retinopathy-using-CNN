{% extends "base.html" %}
{% block content %}

<style>
    body{
        font-family:Arial, sans-serif;
        background:#f4f6f8;
        margin:0
    }

    .container{
        max-width:1100px;
        margin:40px auto
    }

    .hero{
        background:linear-gradient(135deg,#ff4d4d,#ff7a7a);
        color:white;
        padding:50px 30px;
        border-radius:20px;
        text-align:center;
        margin-bottom:40px
    }

    .grid{
        display:grid;
        grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
        gap:25px
    }

    .card{
        background:white;
        padding:25px;
        border-radius:18px;
        box-shadow:0 8px 20px rgba(0,0,0,0.12)
    }

    .value{
        font-size:32px;
        font-weight:bold;
        margin:10px 0
    }

    .badge{
        display:inline-block;
        padding:6px 14px;
        border-radius:20px;
        font-size:13px;
        font-weight:bold
    }

    .ok{background:#d4edda;color:#155724}
    .warn{background:#fff3cd;color:#856404}
    .danger{background:#f8d7da;color:#721c24}

    .section-title{
        margin:50px 0 20px;
        color:#0d6efd
    }

    .note{
        background:#f1f7ff;
        padding:20px;
        border-left:5px solid #0d6efd;
        border-radius:10px;
        font-size:14px;
        margin-top:40px
    }
</style>

<div class="container">

    <!-- HERO -->
    <div class="hero">
        <h1>‚ù§Ô∏è Live Health Monitoring</h1>
        <p>Real-time IoT based monitoring using ESP32 + MAX30102 sensor</p>
    </div>

    <!-- LIVE VITALS -->
    <div class="grid">
        <div class="card">
            <h3>‚ù§Ô∏è Heart Rate</h3>
            <div class="value"><span id="hr">--</span> BPM</div>
            <span class="badge ok" id="hr_status">--</span>
        </div>

        <div class="card">
            <h3>ü´Å Oxygen Level (SpO‚ÇÇ)</h3>
            <div class="value"><span id="spo2">--</span> %</div>
            <span class="badge ok" id="spo2_status">--</span>
        </div>

        <div class="card">
            <h3>üì° Sensor Status</h3>
            <div class="value" id="status">--</div>
            <p style="font-size:14px;margin-top:10px">
                Live data streaming from IoT device
            </p>
        </div>
    </div>

    <!-- RISK -->
    <h2 class="section-title">‚ö†Ô∏è Risk Prediction</h2>
    <div class="card">
        <ul id="risk"></ul>
    </div>

    <!-- ADVICE -->
    <h2 class="section-title">‚úÖ Preventive Advice</h2>
    <div class="card">
        <ul id="advice"></ul>
    </div>

    <!-- EXTRA INFO -->
    <h2 class="section-title">üìò How This Helps</h2>
    <div class="grid">
        <div class="card">‚úî Continuous monitoring of heart & oxygen levels</div>
        <div class="card">‚úî Early detection of abnormal vitals</div>
        <div class="card">‚úî AI-based risk assessment</div>
        <div class="card">‚úî Useful for elderly & chronic patients</div>
    </div>

    <div class="note">
        ‚ö†Ô∏è <b>Medical Disclaimer:</b><br>
        This live monitoring system provides real-time vitals and AI-based
        risk analysis for awareness only. It does not replace professional
        medical diagnosis.
    </div>

</div>

<script>
function fetchData(){
    fetch("/live_sensor")
    .then(r=>r.json())
    .then(d=>{
        document.getElementById("hr").innerText=d.heart_rate ?? "--";
        document.getElementById("spo2").innerText=d.spo2 ?? "--";
        document.getElementById("status").innerText=d.status ?? "--";
    });

    fetch("/health_analysis")
    .then(r=>r.json())
    .then(d=>{
        document.getElementById("hr_status").innerText=d.heart_rate_status ?? "--";
        document.getElementById("spo2_status").innerText=d.spo2_status ?? "--";

        let rEl=document.getElementById("risk");
        rEl.innerHTML="";
        d.risk.forEach(x=>{
            let li=document.createElement("li");
            li.innerText=x;
            rEl.appendChild(li);
        });

        let aEl=document.getElementById("advice");
        aEl.innerHTML="";
        d.advice.forEach(x=>{
            let li=document.createElement("li");
            li.innerText=x;
            aEl.appendChild(li);
        });
    });
}

setInterval(fetchData,2000);
fetchData();
</script>

{% endblock %}
